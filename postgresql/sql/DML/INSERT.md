# INSERT

指定したテーブルに新しい行を挿入する。

```sql
[WITH]
INSERT INTO <table_name> [AS] [(<column_name>[, ...])]
    [OVERRIDING]
    {DEFAULT VALUES | VALUES | <query>}
    [ON CONFLICT]
    [RETURNING]
```

## パラメータ

<details><summary>table_name</summary>

行を挿入する対象のテーブル

</details>

<details><summary>column_name</summary>

挿入する行に設定する列名。一つも指定しなかった場合は、　

定義順にすべての列名がはいる。ここに並べた列名の順で

値を渡す必要がある。`DO UPDATE`が使用されている場合、

列名にテーブル名は含められない。

</details>

<details><summary>query</summary>

クエリをわたすことで、そのクエリの結果をそのテーブルに挿入することができます。

</details>

## 句

<details><summary>WITH</summary>

メインクエリで参照可能なサブクエリを指定できる。

このサブクエリはこの文で一時テーブルとし提供され、

メインクエリで複数回使用される場合も、計算は

最初の一度のみになります。また`RETURNING`を

使用したサブクエリはここに記述する必要があります。

サブクエリは複数指定でき、

```sql
WITH {TABLE | [RECURSIVE] <with_query_name> AS}[,...]
```

### パラメータ

<details><summary>with_query_name</summary>

サブクエリの名前を指定する。

指定した名前を使ってメインクエリで参照できる。

</details>

### 句

<details><summary>TABLE</summary>

テーブルを対象とする。

```sql
TABLE <table_name>
```

</details>


<details><summary>AS</summary>

サブクエリを指定する

```sql
AS [MATERIALIZED] (<sub_query>)
```

#### パラメータ

<details><summary>sub_query</summary>

サブクエリ

##### 備考

<details><summary>自己結合</summary>

`RECURSIVE`が指定されたときに使用できる自己結合の式。

```sql
<non_recursive_term> UNION [ ALL | DISTINCT ] <recursive_term>
```

</details>

</details>

#### 句

<details><summary>MATERIALIZED</summary>

最初の一度だけ計算される。デフォルトなので、省略可能。

```sql
[NOT] MATERIALIZED
```

##### 句

<details><summary>NOT</summary>

つけることで呼ばれるたびに計算させる。

```sql
NOT
```

</details>

</details>

</details>

<details><summary>RECURSIVE</summary>

サブクエリが自己結合できるようになる。

```sql
RECURSIVE
```

</details>

</details>

<details><summary>AS</summary>

テーブル名にエイリアスをつける。`AS`は省略可能。

```sql
[AS] <alias>
```

</details>

<details><summary>OVERRIDING</summary>

`GENERATED {ALWAYS | BY DEFAULT}`で定義された`IDENTITY`列に明示的な値を

無視できるようになる。

```sql
OVERRIDING {SYSTEM | USER}
```

### 句

<details><summary>SYSTEM</summary>

`GENERATED ALWAYS`で定義された`IDENTITY`列を上書きできるようになる。

もし指定されていない場合に上書きしようとするとエラーになる。

```sql
SYSTEM VALUE
```

</details>

<details><summary>USER</summary>

`GENERATED BY DEFAULT`で定美された`IDENTITY`列を上書きできるようになる。

```sql
USER VALUE
```

</details>

</details>

<details><summary>DEFAULTS VALUES</summary>

すべての列に、それぞれのデフォルト値が設定される。

</details>

<details><summary>VALUES</summary>

指定した列名の順番で指定した値を渡す。

```sql
VALUES (<expression> | DEFAULT)[, ...]
```

### パラメータ

<details><summary>expression</summary>

その列に入れる値

</details>


### 句

<details><summary>DEFAULT</summary>

その列のデフォルト値をいれる。

```sql
DEFAULT
```

</details>

</details>

<details><summary>ON CONFLICT</summary>

衝突した場合の処理を記述する。この句を省略した場合、

衝突するとエラーになる。

```sql
ON CONFLICT [(<conflict_target>[, ...])] DO
```

### パラメータ

<details><summary>conflict_target</summary>

一意の列名を指定する。

`DO NOTHING`のときは省略が可能。

</details>

### 句

<details><summary>DO</summary>

```sql
DO {NOTHING | UPDATE}
```

#### 句

<details><summary>NOTHING</summary>

衝突したら何も行わない。

```sql
NOTHING
```

</details>

<details><summary>UPDATE</summary>

衝突したら、挿入の代わりにその行を更新する。

挿入しようとしていた行には`EXCLUDED`を使用して、

アクセスできます。

```sql
UPDATE SET
    {
        <column_name> = {<expression> | DEFAULT}
        | (<column_name>[, ...]) = ({<expression> | DEFAULT}[, ...])
        | (<column_name>[, ...]) = (<sub_query>)
    }[, ...]
    [WHERE]
```

#### パラメータ

<details><summary>column_name</summary>

列名を指定する。

</details>

<details><summary>expression</summary>

更新の値をいれる。複数の列目を指定した場合は、

同じ順番で同じ数だけ値を指定する。

</details>

<details><summary>sub_query</summary>

指定した列名と同じ順番で同じかずの列を返すサブクエリ。

</details>

#### 句

<details><summary>DEFAULT</summary>

デフォルトの値

```sql
DEFAULT
```

</details>

<details><summary>WHERE</summary>

更新する場合の条件をいれる。

```sql
WHERE condition
```

</details>

#### 例

<details><summary>EXCLUDED</summary>

```sql
INSERT INTO distributors (did, dname)
    VALUES (5, 'Gizmo Transglobal'), (6, 'Associated Computing, Inc')
    ON CONFLICT (did) DO UPDATE SET dname = EXCLUDED.dname;
```

</details>

</details>

</details>

</details>

<details><summary>RETURNING</summary>

挿入または更新した行の集合を返す。

`DO NOTHING`が処理された行は含まれない。

```sql
RETURNING {<output_expression> [AS]}[,...]
```

### パラメータ

<details><summary>output_expression</summary>

任意の列名をしてする。複数指定することも可能。

全ての列を指定する場合は`*`を指定する。

</details>


### 句

<details><summary>AS</summary>

出力する列に列名をつける。省略することも可能。

```sql
[AS] <output_name>
```

</details>

</details>
